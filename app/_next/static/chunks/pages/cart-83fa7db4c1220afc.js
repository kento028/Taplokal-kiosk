(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[190],{4688:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/cart",function(){return a(6199)}])},6199:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return p}});var s=a(4246),r=a(7378),n=a(3662),i=a(8579),l=a.n(i),c=a(2696),o=a(156),d=e=>{let{items:t,cartId:a}=e,r=async()=>{let e={...t,quantity:t.quantity+1};await i(e)},n=async()=>{if(t.quantity>1){let e={...t,quantity:t.quantity-1};await i(e)}else await d()},i=async e=>{let s=(0,c.JU)(o.fs,"carts",a),r=(await (0,c.QT)(s)).data();if(!r){console.error("Cart data is undefined");return}let n=r.items.map(a=>a.menuItemId===t.menuItemId?e:a);await (0,c.r7)(s,{items:n.filter(Boolean)})},d=async()=>{let e=(0,c.JU)(o.fs,"carts",a),s=(await (0,c.QT)(e)).data();if(!s){console.error("Cart data is undefined");return}let r=s.items.filter(e=>e.menuItemId!==t.menuItemId);await (0,c.r7)(e,{items:r.filter(Boolean)})};return(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mt-5",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-foreground rounded-lg relative",children:(0,s.jsx)(l(),{src:t.imageURL,alt:t.name,layout:"fill",objectFit:"cover",className:"rounded-lg"})}),(0,s.jsxs)("div",{className:"ml-5",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold",children:t.name}),(0,s.jsx)("p",{className:"text-sm",children:"Rice, anchovies, peanuts, egg, cucumber, sambal"}),(0,s.jsxs)("p",{className:"text-sm",children:["x",t.quantity]})]})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsxs)("p",{className:"text-lg font-semibold",children:["₱",t.price*t.quantity,".00"]}),(0,s.jsx)("button",{onClick:n,className:"ml-5 bg-foreground text-white px-2 py-1 rounded-lg",children:"-"}),(0,s.jsx)("button",{onClick:r,className:"ml-2 bg-foreground text-white px-2 py-1 rounded-lg",children:"+"})]})]}),(0,s.jsx)("hr",{className:"my-5"})]})},u=a(5332),m=a(3296),f=e=>{let t=new Date,a=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0"),n=String(t.getHours()).padStart(2,"0"),i=String(t.getMinutes()).padStart(2,"0"),l=String(t.getSeconds()).padStart(2,"0"),c=String(e).padStart(4,"0");return"TX".concat(a).concat(s).concat(r,"-").concat(n).concat(i).concat(l,"-").concat(c)};let x=async(e,t)=>{window.ipc.send("print-receipt",{items:e,newOrderNumber:t})};var g=a(9894),h=a.n(g),p=()=>{let e=(0,n.useRouter)(),[t,a]=(0,r.useState)("dinein"),[i,l]=(0,r.useState)([]),[g,p]=(0,r.useState)(null),[b,w]=(0,r.useState)(""),[y,N]=(0,r.useState)(0);(0,r.useEffect)(()=>{let e=localStorage.getItem("tableNumber"),t=localStorage.getItem("method");N(Number(e)),a(t);let s=(0,m.Aj)(o.I8,e=>p(e));return()=>s()},[]),(0,r.useEffect)(()=>{let e=()=>{};if(!g)return;let t=(0,c.hJ)(o.fs,"carts"),a=(0,c.IO)(t,(0,c.ar)("customerId","==",g.uid));return e=(0,c.cf)(a,e=>{if(e.empty)l([]);else{let t=e.docs[0];w(t.id),l(t.data().items.map((e,t)=>({id:t,name:e.name,price:e.price,menuItemId:e.menuItemId,quantity:e.quantity,imageURL:e.imageURL||""})))}},e=>{console.error("Error fetching cart item count: ",e)}),()=>e()},[g,e]);let j=async e=>{e.preventDefault(),u.ZP.dismiss();let a=e.currentTarget;if(a.disabled=!0,"dine in"===t&&0!==y){var s;let e=(0,c.JU)(o.fs,"tables","table_".concat(y));if((null===(s=(await (0,c.QT)(e)).data())||void 0===s?void 0:s.status)==="occupied"){u.ZP.error("Table is already occupied");return}await (0,c.pl)(e,{tableNumber:y,status:"occupied"})}if(g){if(0===i.length){u.ZP.error("No items in cart"),a.disabled=!1;return}try{let e=i.map(async e=>{var t;let a=(0,c.JU)(o.fs,"menu",e.menuItemId),s=await (0,c.QT)(a);if(!s.exists())throw Error("Item ".concat(e.name," does not exist"));let r=(null===(t=s.data())||void 0===t?void 0:t.stock)||0;if(r<e.quantity)throw Error("Available stock for ".concat(e.name," is ").concat(r));await (0,c.r7)(a,{stock:r-e.quantity})});await Promise.all(e),await (0,c.i3)(o.fs,async e=>{let a;let s=(0,c.JU)(o.fs,"counters","checkoutCounter"),r=await e.get(s);r.exists()?(a=r.data().count+1,e.update(s,{count:(0,c.nP)(1)})):(a=1e3,e.set(s,{count:1e3}));let n=(0,c.hJ)(o.fs,"checkouts"),l=f(a);await (0,c.ET)(n,{customerId:"kiosk",items:i,status:"pending",tableNumber:y,transactionNumber:l,dineInOrTakeout:t,createdAt:new Date,orderNumber:a});let d=(0,c.JU)(o.fs,"carts",b);e.update(d,{items:[]}),x(i,a),u.ZP.success("Checkout successful!")})}catch(e){u.ZP.error("Checkout failed. Please try again. "+e.message)}finally{a.disabled=!1}}};return(0,s.jsxs)("div",{className:"py-5 px-40",children:[(0,s.jsxs)("div",{className:"flex flex-row justify-between",children:[(0,s.jsx)("h2",{className:"text-lg lg:text-3xl font-bold uppercase",children:"My Order"}),(0,s.jsx)(h(),{href:"/table",className:"bg-foreground py-1 px-2 text-white rounded-xl",children:"Select Table Here"})]}),i.length>0?i.map((e,t)=>(0,s.jsx)(d,{items:e,cartId:b},t)):(0,s.jsx)("p",{className:"text-center mt-5 text-lg",children:"No items in cart"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex justify-between mt-5",children:[(0,s.jsx)("h2",{className:"text-lg lg:text-3xl font-bold uppercase",children:"Total"}),(0,s.jsxs)("h2",{className:"text-lg lg:text-3xl font-bold uppercase",children:["₱",i.reduce((e,t)=>e+t.price*t.quantity,0),".00"]})]}),(0,s.jsx)("button",{onClick:e=>j(e),className:"bg-foreground border border-foreground hover:bg-foreground/20 hover:text-foreground text-white px-5 py-2 rounded-lg w-full mt-5",children:"Checkout"})]})]})}}},function(e){e.O(0,[888,774,179],function(){return e(e.s=4688)}),_N_E=e.O()}]);